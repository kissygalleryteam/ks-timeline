/*!build time : 2015-04-11 1:08:33 PM*/
KISSY.add("kg/ks-timeline/3.0.0/base",function(a){function b(){}return b.prototype={get:function(b){var c=this.ATTRS;return void 0===c[b]?void 0:a.isObject(c[b])?a.isFunction(c[b].value)?c[b].value():c[b].value:c[b]},set:function(b,c){var d=this.ATTRS;return void 0===d[b]?(d[b]={},d[b].value=c):a.isObject(d[b])?void 0===d[b].setter?d[b].value=c:d[b].setter():d[b].value=c}},b}),KISSY.add("kg/ks-timeline/3.0.0/main-content",function(a,b,c,d){function e(b){this.config=b,this.ATTRS=a.clone(g),this._init()}var f=a.all,g={html:{value:'<div class="timenav K_Timenav" style="left:0;">                <div class="time-points K_MarkerBox">                </div>                <div class="time-interval">                  <div class="time-interval-major K_IntervalBox"></div>                </div>                <div class="time-ruler K_TimeRuler"></div>              </div>'},tpl_marker:{value:'<div class="marker K_Marker" id="marker_{{id}}" style="left: {{left}}px;" data-req=\'{{data}}\'>                <div class="flag" style="top:{{top}}px">                  <div class="flag-content">                    <div class="thumbnail"></div>                    <h3>{{title}}</h3>                  </div>                </div>                <div class="dot"></div>                <div class="line">                  <div class="event-line"></div>                </div>              </div>'},tpl_interal:{value:'<div class="a-interval" style="left: {{left}}px;">{{time}}</div>'},cBox:{value:null},markerBox:{value:null},intervalBox:{value:null},timeRuler:{value:null},timenav:{value:null}},h={ATTRS:g,_init:function(){{var a=this;a.config}a.dragBufferAnim=null,a.isRating=!1,a.cdY=1,a.markerEles=[],a.activeMarkerIdx=null,a.render(),a.adjustStyle(),a.monitorEvent()},leftScroll:function(a){var b=this;b.stopAnim(),b.dragBufferAnim=new d(b.get("timenav")[0],{left:"+="+4*f(document.body).width()/5},{duration:1,easing:"easeOutStrong"}).run(),b.dragBufferAnim.on("step",function(){return b.isOverflow()?!1:void 0})},rightScroll:function(a){var b=this;b.stopAnim(),b.dragBufferAnim=new d(b.get("timenav")[0],{left:"-="+4*f(document.body).width()/5},{duration:1,easing:"easeOutStrong"}).run(),b.dragBufferAnim.on("step",function(){return b.isOverflow()?!1:void 0})},rigidResetOffset:function(a){var b=this;b.stopAnim(),void 0!=a.left&&b.get("timenav").css("left",a.left+"px"),void 0!=a.top&&b.get("timenav").css("top",a.top+"px")},dragBuffer:function(a){var b=this;b.stopAnim(),b.dragBufferAnim=new d(b.get("timenav")[0],{left:a.addLeft},{duration:a.duration/1e3,easing:"easeOutStrong"}).run(),b.dragBufferAnim.on("step",function(){return b.isOverflow()?!1:void 0})},isOverflow:function(){var a=this,b=a.config.trackConfig,c=0;if(b.minLeft>parseInt(a.get("timenav").css("left"),10))a.stopAnim(),c=b.minLeft;else{if(!(b.maxLeft<parseInt(a.get("timenav").css("left"),10)))return;a.stopAnim(),c=b.maxLeft}return a.dragBufferAnim=a.get("timenav").animate({left:c+"px"},{duration:.4,easing:"easeOutStrong"}),!0},stopAnim:function(){this.dragBufferAnim&&this.dragBufferAnim.stop&&this.dragBufferAnim.stop()},resetTimenavPos:function(a,b){var c=this;c.stopAnim(),b&&b===!1||(c.dragBufferAnim=c.get("timenav").animate(a,{duration:1,easing:"easeOutStrong"}))},render:function(b){var c=this,d=c.config;c.set("cBox",f(c.get("html"))),c.set("timenav",c.get("cBox")),c.set("markerBox",f(".K_MarkerBox",c.get("timenav"))),c.set("intervalBox",f(".K_IntervalBox",c.get("timenav"))),c.set("timeRuler",f(".K_TimeRuler",c.get("timenav"))),c.get("timenav").appendTo(d.panel),c.resetTimenavPos({left:parseInt(c.get("timenav").css("left"),10)+d.panel.width()/3}),b&&a.isArray(b)&&c.renderMarkers(b),c.fire("uiReady"),a.UA&&6==a.UA.ie&&(c.get("timenav").delegate("mouseenter",".K_Marker",function(a){f(this).addClass("hover")}),c.get("timenav").delegate("mouseleave",".K_Marker",function(a){f(this).removeClass("hover")}))},renderMarkers:function(b){for(var d=this,e=(d.config,b.length),g=0;e>g;++g){var h=f(c(d.get("tpl_marker")).render({id:b[g].time,title:b[g].title,data:KISSY.JSON.stringify(a.merge({count:g},b[g])),left:b[g].__left,top:(b[g].top||parseInt(55*Math.random(),10))+10}));h.appendTo(d.get("markerBox")),d.markerEles.push(h)}},renderInterval:function(a){var b=this,c=this.config.trackConfig,d=c.widthRate,e=1,f=1;d>=2e3?(e=1,f=1):2e3>d&&d>=1e3?(e=1,f=2):1e3>d&&d>=500?(e=1,f=3):500>d&&d>=250?(e=1,f=4):250>d&&d>=125?(e=1,f=6):125>d&&(e=2,f=12),a&&0!=a?b._styleInterval(e,f):b._renderInterval(e,f)},_renderInterval:function(a,b){var d=this,e=this.config.trackConfig;d.get("intervalBox").html("");for(var g=-1;g<e.endYear-e.beginYear+1;++g){var h=f(c(d.get("tpl_interal")).render({left:5*parseInt(g*e.widthRate/5,10)-2,time:e.beginYear+g-1+".12"}));h.appendTo(d.get("intervalBox")),Math.abs(g)%a!=0&&h.hide();for(var i=1;11>=i;++i){var j=f(c(d.get("tpl_interal")).render({left:5*parseInt((g*e.widthRate+e.widthRate/12*i)/5,10)-2,time:e.beginYear+g+"."+i}));j.appendTo(d.get("intervalBox")),i%b!=0&&j.hide()}}},_styleInterval:function(a,b){for(var c=this,d=this.config.trackConfig,e=f(".a-interval",c.get("intervalBox")),g=-1;g<d.endYear-d.beginYear+1;++g){var h=12*(g+1);e.item(h).animate({left:5*parseInt(g*d.widthRate/5,10)-2},.5),Math.abs(g)%a!=0?e.item(h).hide():e.item(h).show();for(var i=1;11>=i;++i)e.item(h+i).animate({left:5*parseInt((g*d.widthRate+d.widthRate/12*i)/5,10)-2},.5),i%b!=0?e.item(h+i).hide():e.item(h+i).show()}},gotoMarker:function(a,b,c){var d=this,e=d.config;d.get("timenav").all(".marker").removeClass("hover"),b.addClass("hover"),d.stopAnim();var f=a+parseInt(d.get("timenav").css("left"),10)-e.panel.width()/2+3;d.dragBufferAnim=d.get("timenav").animate({left:"-="+f},.5,"easeOutStrong")},adjustStyle:function(){var a=this,b=a.config.trackConfig;a.get("timenav").width(b.navWidth),a.get("intervalBox").width(b.navWidth),a.get("timeRuler").width(9999999).css("left",0-Math.abs(2*b.spacer))},rate:function(a){var b=this,c=b.config;if(1!=b.isRating){c.trackConfig.isScaling=!0,b.stopAnim();var d=f(".marker",b.get("timenav"));d.each(function(b){f(b).animate({left:parseInt(f(b).css("left"),10)*Math.abs(a)},.5)});var e=parseInt(b.get("timenav").css("left"),10),g=(b.get("timenav").width(),c.panel.width()),h=g/2-(0-e+g/2)*a;b.get("timenav").animate({left:h,width:"*="+a},.5,"easeNone",function(){b.adjustStyle(),b.isRating=!1,c.trackConfig.isScaling=!1}),b.renderInterval(!0)}},monitorEvent:function(){{var a=this;a.config}f(window).on("resize",function(){a.adjustStyle()}),a.get("timenav").on("click",function(b){b.halt();var c=f(b.target);if(c.hasClass("marker"))c=c;else{if(null==c.parent(".marker"))return!1;c=c.parent(".marker")}a.clickThisMarder(c)})},clickThisMarder:function(b){var c=this,d=a.JSON.parse(b.attr("data-req"));return c.gotoMarker(parseInt(b.css("left"),10),b),c.activeMarkerIdx==d.count?!1:(c.activeMarkerIdx=d.count,c.fire("marker",{data:d,target:b}),void c.setHash())},setHash:function(){return!1},prev:function(){var a=(this.activeMarkerIdx-1+this.markerEles.length)%this.markerEles.length||0;this.clickThisMarder(this.markerEles[a]),this.activeMarkerIdx=a},next:function(){var a=(this.activeMarkerIdx+1+this.markerEles.length)%this.markerEles.length||0;this.clickThisMarder(this.markerEles[a]),this.activeMarkerIdx=a},switchTo:function(a){return 0>a||a>=this.markerEles.length?!1:void this.clickThisMarder(this.markerEles[a])}};return a.augment(e,b,a.EventTarget,h),e},{attach:!1,requires:["./base","template","anim"]});