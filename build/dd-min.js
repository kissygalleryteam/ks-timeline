/*!build time : 2015-04-11 1:08:33 PM*/
KISSY.add("kg/ks-timeline/3.0.0/base",function(a){function b(){}return b.prototype={get:function(b){var c=this.ATTRS;return void 0===c[b]?void 0:a.isObject(c[b])?a.isFunction(c[b].value)?c[b].value():c[b].value:c[b]},set:function(b,c){var d=this.ATTRS;return void 0===d[b]?(d[b]={},d[b].value=c):a.isObject(d[b])?void 0===d[b].setter?d[b].value=c:d[b].setter():d[b].value=c}},b}),KISSY.add("kg/ks-timeline/3.0.0/dd",function(a,b){function c(a,b){return this.panel=a&&"string"==typeof a?d((/^\s*[#|.]/.test(a)?"":"#")+a):a,void 0==this.panel?(alert("[DD] panel is undefined"),!1):(this.__attr=b,void this._init())}var d=a.all,e=a.DOM,f={_init:function(){var a=this;a.dragEle=d(a.get("dragEle"),a.panel),a.set("dragInfoX",[]),a.set("dragInfoY",[]),a.set("dragInfoTime",[]),a.set("ddMask",null),a.panel.on("mousedown",function(b){b.halt(),b.button&&2==b.button||(a.set("ix",b.pageX),a.set("iy",b.pageY),a.set("tx",parseInt(a.dragEle.css("left"),10)),a.set("ty",parseInt(a.dragEle.css("top"),10)),a.set("dragInfoX",[]),a.set("dragInfoY",[]),a.set("dragInfoTime",[]),a._bindWindowEvent())})},_bindWindowEvent:function(){var a=this;d(document).on("mouseup",a._handleWindowMouseup,a),d(document).on("mousemove",a._handleWindowMousemove,a)},_cancelWindowEvent:function(){var a=this;d(document).detach("mouseup",a._handleWindowMouseup,a),d(document).detach("mousemove",a._handleWindowMousemove,a)},_handleWindowMousemove:function(a){a.preventDefault();var b=this;null==b.get("ddMask")&&(b.set("ddMask",e.create('<div class="timeline-dd-mask"></div>')),document.body&&document.body.appendChild(b.get("ddMask"))),b.get("dragInfoX").push(a.pageX),b.get("dragInfoY").push(a.pageY),b.get("dragInfoTime").push((new Date).getTime()),b.fire("moving",{ox:a.pageX-b.get("ix")+b.get("tx"),oy:a.pageY-b.get("iy")+b.get("ty")})},_handleWindowMouseup:function(a){var b=this;b._cancelWindowEvent(),b.get("dragInfoX").push(a.pageX),b.get("dragInfoY").push(a.pageY),b.get("dragInfoTime").push((new Date).getTime()),b.fire("mouseup",{buffer:b._calculateBuffer()}),e.remove(b.get("ddMask")),b.set("ddMask",null)},_calculateBuffer:function(){var a=this;if(a.get("dragInfoX").length<3)return void 0;for(var b,c={a:1e4,v:100,isLeft:!0},d=a.get("dragInfoX"),e=d.length,f=a.get("dragInfoTime"),g=1,h=d[e-1],i=f[e-1];e>g&&i-f[e-++g]<50;)if(2==g&&h-f[e-g]>500)return void 0;return e>=g?(t1=f[e-g+1],b=d[e-1]-d[e-g],c.v=b/(i-t1)*1e3,c.isLeft=b>0?!0:!1):(c.v=100,c.isLeft=d[e-1]>d[0]?!0:!1),c.absDistance=c.v*c.v/2/c.a,c.addLeft=c.isLeft?"+="+c.absDistance:"-="+c.absDistance,c.duration=Math.abs(parseInt(c.v/c.a*1e3,10)),c},set:function(a,b){return this.__attr[a]=b},get:function(a){return this.__attr[a]}};return a.augment(c,b,a.EventTarget,f),c},{attach:!1,requires:["./base"]});